#!/usr/bin/env node

var fs = require('fs');
var Translator = require('./lib/translator');
var removeEventStreamOperations = require('./lib/remove-event-stream-ops').removeEventStreamOperations;
var util = require('util');
var path = require('path');

/*
 * Minimizes all .normal.json files by flattening shapes, removing
 * documentation and removing unused shapes. The result will be written to
 * `.min.json` file.
 *
 * The passed parameter is base path. The directory must include the apis/
 * folder.
 */
function ApiTranslator(basePath) {
  this._apisPath = path.join(basePath, 'apis');
}

/*
 * minimize passed .normal.json filepath into .min.json
 */
ApiTranslator.prototype.minimizeFile = function minimizeFile(filepath) {
  var opath = filepath.replace(/\.normal\.json$/, '.min.json');
  var data = JSON.parse(fs.readFileSync(path.join(this._apisPath, filepath)).toString());
  var didModify = removeEventStreamOperations(data);
  if (didModify) {
    // original model modified, replace existing normal.json so docs/ts definitions are accurate
    fs.writeFileSync(path.join(this._apisPath, filepath), JSON.string